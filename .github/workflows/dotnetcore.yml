name: .NET Core

on: 
  push:
    branches: 
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 6.0.x            
    - name: Install Dotnet Sonarscanner	
      run: dotnet tool install --global dotnet-sonarscanner                  
    - uses: sonarsource/sonarcloud-github-action@master
      with:
        args: >          
          -Dsonar.organization=marsen-github 
          -Dsonar.projectKey=Marsen.NetCore.Dojo
          -Dsonar.sources=./src/Marsen.NetCore.Dojo 
          -Dsonar.host.url=https://sonarcloud.io 
          -Dsonar.test.exclusions=tests/**
          -Dsonar.tests=./test/Marsen.NetCore.Dojo.Tests
          -Dsonar.verbose=true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
    - name: Build with dotnet
      run: dotnet build ".\Marsen.NetCore.Dojo.Integration.Test.sln"   
    - name: UnitTest Result
      run: dotnet test ./test/Marsen.NetCore.Dojo.Tests/Marsen.NetCore.Dojo.Tests.csproj --logger:trx;LogFileName=result.trx
    - name: UnitTest Coverage
      run: dotnet test ./test/Marsen.NetCore.Dojo.Tests/Marsen.NetCore.Dojo.Tests.csproj --collect:"XPlat Code Coverage" --settings .coverlet       
    - name: Integration Test with dotnet
      run: dotnet test ./test/Marsen.NetCore.Dojo.Integration.Tests/Marsen.NetCore.Dojo.Integration.Tests.csproj --logger:trx;LogFileName=result.trx 
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      SONAR_LOGIN: ${{ secrets.SONAR_LOGIN }}  
